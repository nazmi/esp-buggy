<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="light-mode">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EEEN21000: Innovative Features</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.0.2/jquery.smartmenus.min.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
       <script type="text/javascript">
           DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
        <script type="text/javascript">
            DoxygenAwesomeParagraphLink.init()
        </script>
<link rel="icon" href="icon.ico" type="image/x-icon" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SY2S41MWPX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SY2S41MWPX');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EEEN21000
   </div>
   <div id="projectbrief">GROUP 30 Line Following Buggy</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__f_e_a_t_u_r_e_s.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Innovative Features </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#background">Background</a></li>
<li class="level1"><a href="#hardware">Hardware Solution</a></li>
<li class="level1"><a href="#software">Software Solution</a></li>
<li class="level1"><a href="#results">Results</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="features"></a> </p>
<h1><a class="anchor" id="background"></a>
Background</h1>
<p >High-speed buggy is very achievable by all groups, but cornering will punish those who overlook their control algorithm. Either the buggy will overshoot at high speed or the buggy will slow down and take the corner wisely. Is there a way to corner without lowering the speed? Of course, it is possible with the correct implementation of signal processing. Signal processing is important for line following robot to achieve stability in performance. Simply reading the output of the sensors will not give meaningful components to the software if it is not processed the correct way. This page discusses our attempt to get the best out of the buggy system by incorporating hardware and software solutions to the stated problem.</p>
<h1><a class="anchor" id="hardware"></a>
Hardware Solution</h1>
<p >Although we try our best to test the sensor and get the optimum operating height, it can vary depending on the environment. So designing a chassis based on this constraint may cause trouble for iterative development as we go forward. This also might cause a problem because we only test one sensor to characterise it, not as an array of sensors which we will be using in the final assembly. Our solution to this problem is to use a system that allows us to change the height of the sensors from the ground when the sensors are calibrated. The plate for the sensors can be clamped at a height from the ground of between 2.5 cm to 6 cm. <br  />
</p>
<div style="text-align:center"><img src="sensor1.png" alt="Vertical adjustment" width="60%" class="inline"/></div><p >However, this solution only fixes the problem in the vertical-axis direction. Hence, we further design the sensor plate with long holes to allow an adjustable position of the PCB by using nuts and bolts.</p>
<div style="text-align:center"><img src="sensor2.png" alt="Horizontal adjustment" width="60%" class="inline"/></div><p >Both of these design approaches give us the flexibility to choose the height and position of the sensors that we want, resulting in a better output of the sensors' readings. Next, our sensor array design consists of two rows instead of the traditional one-row system. The inner row consists of two sensors, and the front row consists of four sensors. We created this design based on the consideration that we want to maximise the number of sensors operating and reading outputs. While 6 sensors in a row cover the line almost by 4x its width, our arrangement benefits from its additional row. This allows the buggy to immediately respond to incoming corners when detected by the front row sensors.</p>
<div style="text-align:center"><img src="sensor3.png" alt="PCB design" width="60%" class="inline"/></div><h1><a class="anchor" id="software"></a>
Software Solution</h1>
<p >Determining the position of the line is very simple by using the weighted average as discussed in <a class="el" href="md__d_e_m_o.html#sensor">this section</a>. Recall again that it is simply \(\ distance = \frac{\sum_{1}^{6} reading_i \times weight_i}{\sum_{1}^{6} reading_i} \). This simple method is fast and simple but it is not the best way to determine the position of sensors. The alternative method is to use quadratic interpolation from the sensors. Using this method, not all sensors will be used for calculations because the problem is overdetermined so only four primary sensors' output(the one that is right above the line plus the other two neighbours) is chosen to simplify the problem. Maybe it is easier to visualise this concept using the figure below.</p>
<p ><img src="sensor4.svg" alt="Quadratic interpolation" style="pointer-events: none;" class="inline"/></p>
<p >The position can be determined from \( distance = -\frac{b}{2a} \). The idea behind of the solution is as follows.  \(
\begin{bmatrix}
y_1\\ 
y_2\\ 
y_3\\ 
y_4
\end{bmatrix} 
= 
\begin{bmatrix}
h_1^{2} &amp; h_1 &amp; 1 \\ 
h_2^{2} &amp; h_2 &amp; 1 \\ 
h_3^{2} &amp; h_3 &amp; 1 \\
h_4^{2} &amp; h_4 &amp; 1
\end{bmatrix}
 
\begin{bmatrix}
A\\ 
B\\ 
C
\end{bmatrix} \\\\
Y = HX \\
\text{The problem  can be solved using inverse. } \\
X = H^{-1}Y \\ 
\text{But the problem is overdetermined and can be solved by minimizing the error. } \\
\hat{X} = (H^{T}H)^{-1}H^{T}Y \)</p>
<p >This is where the DSP library from Arm comes in handy. The following code show the implementation of the quadratic interpolation.</p>
<div class="fragment"><div class="line">arm_matrix_instance_f32 computeH(){</div>
<div class="line">    </div>
<div class="line">    arm_matrix_instance_f32 H,HT,HTH,HTHI,HTHIHT;</div>
<div class="line">    <span class="keyword">const</span> float32_t h[4*3] = {</div>
<div class="line">        h_1*h_1, h_1, 1,</div>
<div class="line">        h_2*h_2, h_2, 1,</div>
<div class="line">        h_3*h_3, h_3, 1,</div>
<div class="line">        h_4*h_4, h_4, 1</div>
<div class="line">    };</div>
<div class="line">    arm_mat_init_f32(&amp;H, 4, 3, (float32_t *)h);</div>
<div class="line"> </div>
<div class="line">    float32_t ht[3*4];</div>
<div class="line">    arm_mat_init_f32(&amp;HT, 3, 4, ht);</div>
<div class="line">    arm_mat_trans_f32(&amp;H, &amp;HT);</div>
<div class="line">    </div>
<div class="line">    float32_t hth[3*3];</div>
<div class="line">    arm_mat_init_f32(&amp;HTH, 3, 3, hth);</div>
<div class="line">    arm_mat_mult_f32(&amp;HT,&amp;H,&amp;HTH);</div>
<div class="line"> </div>
<div class="line">    float32_t hthi[3*3];</div>
<div class="line">    arm_mat_init_f32(&amp;HTHI, 3, 3, hthi);</div>
<div class="line">    arm_mat_inverse_f32(&amp;HTH,&amp;HTHI);</div>
<div class="line"> </div>
<div class="line">    float32_t hthiht[3*4];</div>
<div class="line">    arm_mat_init_f32(&amp;HTHIHT, 3, 4, hthiht);</div>
<div class="line">    arm_mat_mult_f32(&amp;HTHI,&amp;HT,&amp;HTHIHT);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> HTHIHT;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">arm_matrix_instance_f32 computeX(<span class="keyword">const</span> arm_matrix_instance_f32* H, <span class="keyword">const</span> arm_matrix_instance_f32* Y){</div>
<div class="line">    arm_matrix_instance_f32 X;</div>
<div class="line">    float32_t x_matrix[3];</div>
<div class="line">    arm_mat_init_f32(&amp;X, 3, 1, x_matrix);</div>
<div class="line">    arm_mat_mult_f32(&amp;HTHIT,&amp;Y,&amp;X);</div>
<div class="line">    <span class="keywordflow">return</span> X;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> computeDistance(<span class="keyword">const</span> arm_matrix_instance_f32* X){</div>
<div class="line">    <span class="keywordflow">return</span> -(X-&gt;pData[1])/(2*X-&gt;pData[0]);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="results"></a>
Results</h1>
<p >We adjusted the height between 2.5cm and 6 cm to get the best readings that do not clip and are not too low. The best height we found was 2.7 cm from the ground. </p><details >
<p ><summary>See...</summary> Showcase the reading values at different height.<br  />
 </p><div align="center"> <img src="height.svg" alt="Height" style="pointer-events: none;" class="inline"/> </div> </details>
<p >For the software solution, we cannot accurately measure the position of the line. But the error in both methods implied that the difference in the measured position is small. However, in time complexity, the quadratic interpolation method is more efficient than the simple method. This is because the H matrix is evaluated at compile time and only one multiplication occurs during runtime.</p>
<details >
<p ><summary>See...</summary> Showcase the distance estimation based on two different method.<br  />
 </p><div align="center"> <img src="quadratic.svg" alt="Comparing Accuracy" style="pointer-events: none;" class="inline"/> <img src="timetaken.svg" alt="Comparing Time" style="pointer-events: none;" class="inline"/> </div> </details>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
